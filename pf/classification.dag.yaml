$schema: https://azuremlschemas.azureedge.net/promptflow/latest/Flow.schema.json
environment:
  python_requirements_txt: ../requirements.txt

inputs:
  input_file:
    type: string
    default: "JVBERi0xLjEKJcKlwrHDqwoKMSAwIG9iagogIDw8IC9UeXBlIC9DYXRhbG9nCiAgICAgL1BhZ2VzIDIgMCBSCiAgPj4KZW5kb2JqCgoyIDAgb2JqCiAgPDwgL1R5cGUgL1BhZ2VzCiAgICAgL0tpZHMgWzMgMCBSXQogICAgIC9Db3VudCAxCiAgICAgL01lZGlhQm94IFswIDAgMzAwIDE0NF0KICA+PgplbmRvYmoKCjMgMCBvYmoKICA8PCAgL1R5cGUgL1BhZ2UKICAgICAgL1BhcmVudCAyIDAgUgogICAgICAvUmVzb3VyY2VzCiAgICAgICA8PCAvRm9udAogICAgICAgICAgIDw8IC9GMQogICAgICAgICAgICAgICA8PCAvVHlwZSAvRm9udAogICAgICAgICAgICAgICAgICAvU3VidHlwZSAvVHlwZTEKICAgICAgICAgICAgICAgICAgL0Jhc2VGb250IC9UaW1lcy1Sb21hbgogICAgICAgICAgICAgICA+PgogICAgICAgICAgID4+CiAgICAgICA+PgogICAgICAvQ29udGVudHMgNCAwIFIKICA+PgplbmRvYmoKCjQgMCBvYmoKICA8PCAvTGVuZ3RoIDU1ID4+CnN0cmVhbQogIEJUCiAgICAvRjEgMTggVGYKICAgIDAgMCBUZAogICAgKEhlbGxvIFdvcmxkKSBUagogIEVUCmVuZHN0cmVhbQplbmRvYmoKCnhyZWYKMCA1CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDAxOCAwMDAwMCBuIAowMDAwMDAwMDc3IDAwMDAwIG4gCjAwMDAwMDAxNzggMDAwMDAgbiAKMDAwMDAwMDQ1NyAwMDAwMCBuIAp0cmFpbGVyCiAgPDwgIC9Sb290IDEgMCBSCiAgICAgIC9TaXplIDUKICA+PgpzdGFydHhyZWYKNTY1CiUlRU9GCg=="
  callback_url:
    type: string
    default: https://webhook.site/f257b2bf-6cd9-42aa-b3cc-b5e2630bf37b

  json_schema:
    type: object
    default: { "name": "documentTags", "strict": false, "schema": { "type": "object", "properties": { "document_name": { "type": "string", "description": "The primary name of the document", "enum": [ "Advice of release", "Bankruptcy Search Result/ Company Winding Up Search Result", "Statutory Declaration (Owner Occupancy)", "Acknowledgement of Legal Representation", "Land Search", "Confirmation Letter from Pajabat Tanah dan Galian", "Confirmation Letter from Perbadanan Kemajuan Perumahan Negeri", "Quit Rent", "Full Power of Attorney", "Solicitor Letter of Undertaking", "Redemption Statement", "Developer Letter of Undertaking", "Letter of Offer", "Notice of Assignment", "Presentation Receipt", "Deed of Assignment", "Sale & Purchase Agreement", "Commodity Murabahah Facility Agreement" ] }, "sub_document_name": { "type": "string", "description": "The subcategory or alternate name for the document", "enum": [ "Advise of Release", "Bankruptcy Search Result/ Company Winding Up Search Result", "Stamp Certificate", "Statutory Declaration (Owner Occupancy)", "Acknowledgement of Legal Representation", "Land Search", "Confirmation Letter from Pajabat Tanah dan Galian", "Confirmation Letter from Perbadanan Kemajuan Perumahan Negeri", "Quit Rent", "Full Power of Attorney", "Solicitor Letter of Undertaking", "Redemption Statement", "Developer Letter of Undertaking", "Letter of Offer", "Notice of Assignment", "Presentation Receipt", "Deed of Assignment", "Sale & Purchase Agreement", "Commodity Murabahah Facility Agreement" ] }, "confidence": { "type": "number", "description": "The confidence level to the result, ranged from 0 to 1, can be in floating value" }, "reasoning": { "type": "string", "description": "Detailed explanation or matching criteria for the document" } }, "required": [ "document_name", "sub_document_name", "confidence", "reasoning" ] } }

nodes:
- name: load_document
  type: python
  source:
    type: code
    path: ./tools/load_file.py
  inputs:
    file_path: ${inputs.input_file}

- name: optimize_image
  type: python
  source:
    type: code
    path: ./tools/optimize_image.py
  inputs:
    image_bytes: ${load_document.output}

- name: perform_ocr
  type: python
  source:
    type: code
    path: ./tools/perform_ocr.py
  inputs:
    image_bytes: ${optimize_image.output}

- name: perform_segmentation
  type: python
  source:
    type: code
    path: ./tools/perform_segmentation.py
  inputs:
    pages: ${perform_ocr.output.pages}
    json_schema: ${inputs.json_schema}

outputs:
  classification_result:
    type: object
    reference: ${perform_segmentation.output}
